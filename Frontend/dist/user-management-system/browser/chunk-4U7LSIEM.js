import{a as N}from"./chunk-MML34MOX.js";import{a as F}from"./chunk-XBJCHOAX.js";import{A as u,Aa as de,B as y,Ba as k,C as _,D as c,Da as L,F as s,Fa as me,G as v,H as C,I as j,J as $,O as S,Q as G,R as E,S as A,T as z,V as O,W as w,X as P,Y as T,Z as Q,_ as U,a as B,fa as H,ga as b,ha as J,ia as K,j as f,ka as W,l as q,la as X,ma as Y,n as I,na as Z,o as M,oa as ee,p as x,pa as te,q as h,qa as ie,ra as ne,s as a,sa as re,t as g,ta as oe,u as l,v as d,wa as ae,y as i,ya as se,z as n}from"./chunk-2D5NW3EL.js";var be=(t,m,e)=>({"badge bg-warning":t,"badge bg-success":m,"badge bg-danger":e});function xe(t,m){t&1&&(i(0,"th"),s(1,"Actions"),n())}function he(t,m){t&1&&(i(0,"tr")(1,"td",12)(2,"div",13)(3,"span",14),s(4,"Loading..."),n()()()())}function ye(t,m){t&1&&(i(0,"tr")(1,"td",12),u(2,"i",15)(3,"br"),i(4,"span",16),s(5,"No requests found"),n()()())}function Ce(t,m){if(t&1&&(i(0,"li"),s(1),n()),t&2){let e=m.$implicit;a(),j(" ",e.description," (",e.quantity,") ")}}function Se(t,m){if(t&1){let e=y();i(0,"button",27),_("click",function(){x(e);let r=c(2).$implicit,p=c();return h(p.approveRequest(r.id))}),u(1,"i",28),i(2,"span"),s(3,"Approve"),n()()}}function Ee(t,m){if(t&1){let e=y();i(0,"button",29),_("click",function(){x(e);let r=c(2).$implicit,p=c();return h(p.rejectRequest(r.id))}),u(1,"i",30),i(2,"span"),s(3,"Reject"),n()()}}function qe(t,m){if(t&1){let e=y();i(0,"td")(1,"div",22),l(2,Se,4,0,"button",23)(3,Ee,4,0,"button",24),i(4,"button",25),_("click",function(){x(e);let r=c().$implicit,p=c();return h(p.deleteRequest(r.id))}),u(5,"i",26),i(6,"span"),s(7,"Delete"),n()()()()}if(t&2){let e=c().$implicit;a(2),d("ngIf",e.status==="Pending"),a(),d("ngIf",e.status==="Pending")}}function Ie(t,m){if(t&1&&(i(0,"tr",17)(1,"td"),s(2),E(3,"titlecase"),n(),i(4,"td"),s(5),n(),i(6,"td")(7,"span",18),s(8),n()(),i(9,"td"),s(10),i(11,"small",19),s(12),n()(),i(13,"td")(14,"ul",20),l(15,Ce,2,2,"li",21),n()(),i(16,"td"),s(17),E(18,"date"),n(),l(19,qe,8,2,"td",10),n()),t&2){let e=m.$implicit,o=c();a(2),v(A(3,10,e.type)),a(3),v(e.description),a(2),d("ngClass",G(15,be,e.status==="Pending",e.status==="Approved",e.status==="Rejected")),a(),C(" ",e.status," "),a(2),j(" ",e.employee==null?null:e.employee.firstName," ",e.employee==null?null:e.employee.lastName," "),a(2),v(e.employee==null?null:e.employee.position),a(3),d("ngForOf",e.items),a(2),v(z(18,12,e.createdAt,"medium")),a(2),d("ngIf",o.isAdmin)}}var le=(()=>{class t{requestService;accountService;requests=[];loading=!1;isAdmin=!1;constructor(e,o){this.requestService=e,this.accountService=o,this.isAdmin=this.accountService.accountValue?.role==="Admin"}ngOnInit(){if(this.loading=!0,this.isAdmin)this.requestService.getAll().pipe(f()).subscribe(e=>{this.requests=e,this.loading=!1});else{let e=this.accountService.accountValue?.id;e&&this.requestService.getByEmployeeId(Number(e)).pipe(f()).subscribe(o=>{this.requests=o,this.loading=!1})}}deleteRequest(e){confirm("Are you sure you want to delete this request?")&&(this.loading=!0,this.requestService.delete(e).pipe(f()).subscribe({next:()=>{this.requests=this.requests.filter(o=>o.id!==e),this.loading=!1},error:o=>{alert("Failed to delete request."),this.loading=!1}}))}approveRequest(e){this.loading=!0,this.requestService.approve(e).pipe(f()).subscribe({next:o=>{let r=this.requests.findIndex(p=>p.id===e);r!==-1&&(this.requests[r]=o),this.loading=!1},error:o=>{alert("Failed to approve request."),this.loading=!1}})}rejectRequest(e){this.loading=!0,this.requestService.reject(e).pipe(f()).subscribe({next:o=>{let r=this.requests.findIndex(p=>p.id===e);r!==-1&&(this.requests[r]=o),this.loading=!1},error:o=>{alert("Failed to reject request."),this.loading=!1}})}static \u0275fac=function(o){return new(o||t)(g(N),g(F))};static \u0275cmp=I({type:t,selectors:[["ng-component"]],decls:30,vars:4,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],["routerLink","add",1,"btn","btn-primary","d-flex","align-items-center","gap-2"],[1,"fas","fa-plus"],[1,"card","shadow-sm"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-striped","align-middle"],[1,"table-light"],[4,"ngIf"],["class","table-row-hover",4,"ngFor","ngForOf"],["colspan","7",1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"fas","fa-inbox","fa-2x","text-muted","mb-2"],[1,"text-muted"],[1,"table-row-hover"],[3,"ngClass"],[1,"d-block","text-muted"],[1,"list-unstyled","mb-0"],[4,"ngFor","ngForOf"],[1,"btn-group","gap-1"],["class","btn btn-sm btn-success d-flex align-items-center gap-1","title","Approve",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger d-flex align-items-center gap-1","title","Reject",3,"click",4,"ngIf"],["title","Delete",1,"btn","btn-sm","btn-outline-danger","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-trash"],["title","Approve",1,"btn","btn-sm","btn-success","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-check"],["title","Reject",1,"btn","btn-sm","btn-danger","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-times"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Requests"),n(),i(4,"button",3),u(5,"i",4),s(6," Create Request "),n()(),i(7,"div",5)(8,"div",6)(9,"div",7)(10,"table",8)(11,"thead",9)(12,"tr")(13,"th"),s(14,"Type"),n(),i(15,"th"),s(16,"Description"),n(),i(17,"th"),s(18,"Status"),n(),i(19,"th"),s(20,"Employee"),n(),i(21,"th"),s(22,"Items"),n(),i(23,"th"),s(24,"Created"),n(),l(25,xe,2,0,"th",10),n()(),i(26,"tbody"),l(27,he,5,0,"tr",10)(28,ye,6,0,"tr",10)(29,Ie,20,19,"tr",11),n()()()()()()),o&2&&(a(25),d("ngIf",r.isAdmin),a(2),d("ngIf",r.loading),a(),d("ngIf",!r.loading&&r.requests.length===0),a(),d("ngForOf",r.requests))},dependencies:[O,w,P,k,T,Q],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600}.badge[_ngcontent-%COMP%]{font-size:.85em;padding:.5em .75em}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem;transition:background .2s,color .2s,box-shadow .2s}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover, .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:focus{box-shadow:0 2px 8px #00000014;z-index:1}.list-unstyled[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.text-muted[_ngcontent-%COMP%]{font-size:.875rem}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .2s}.card[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #e3e6ea}.card-body[_ngcontent-%COMP%]{padding:2rem}.table[_ngcontent-%COMP%]{margin-bottom:0}"]})}return t})();var R=t=>({"is-invalid":t});function Me(t,m){if(t&1&&(i(0,"option",24),s(1),E(2,"titlecase"),n()),t&2){let e=m.$implicit;d("value",e),a(),v(A(2,2,e))}}function Ae(t,m){t&1&&(i(0,"div"),s(1,"Type is required"),n())}function Oe(t,m){if(t&1&&(i(0,"div",25),l(1,Ae,2,0,"div",26),n()),t&2){let e=c();a(),d("ngIf",e.f.type.errors.required)}}function we(t,m){if(t&1&&(i(0,"option",24),s(1),n()),t&2){let e=m.$implicit;d("value",e.id),a(),$(" ",e.employeeId," - ",e.firstName," ",e.lastName," ")}}function Pe(t,m){t&1&&(i(0,"div"),s(1,"Employee is required"),n())}function Te(t,m){if(t&1&&(i(0,"div",25),l(1,Pe,2,0,"div",26),n()),t&2){let e=c();a(),d("ngIf",e.f.employeeId.errors.required)}}function ke(t,m){t&1&&(i(0,"div"),s(1,"Description is required"),n())}function Fe(t,m){if(t&1&&(i(0,"div",25),l(1,ke,2,0,"div",26),n()),t&2){let e=c().$implicit;a(),d("ngIf",e.get("description").errors.required)}}function Ne(t,m){t&1&&(i(0,"div"),s(1,"Quantity is required"),n())}function Re(t,m){t&1&&(i(0,"div"),s(1,"Quantity must be at least 1"),n())}function je(t,m){if(t&1&&(i(0,"div",25),l(1,Ne,2,0,"div",26)(2,Re,2,0,"div",26),n()),t&2){let e=c().$implicit;a(),d("ngIf",e.get("quantity").errors.required),a(),d("ngIf",e.get("quantity").errors.min)}}function Le(t,m){if(t&1){let e=y();i(0,"div",27)(1,"div",28)(2,"div",29),u(3,"input",30),l(4,Fe,2,1,"div",11),n(),i(5,"div",31),u(6,"input",32),l(7,je,3,2,"div",11),n(),i(8,"div",31)(9,"button",33),_("click",function(){let r=x(e).index,p=c();return h(p.removeItem(r))}),u(10,"i",34),n()()()()}if(t&2){let e=m.$implicit,o=m.index,r=c();d("formGroupName",o),a(3),d("ngClass",S(5,R,r.submitted&&e.get("description").errors)),a(),d("ngIf",r.submitted&&e.get("description").errors),a(2),d("ngClass",S(7,R,r.submitted&&e.get("quantity").errors)),a(),d("ngIf",r.submitted&&e.get("quantity").errors)}}function Ve(t,m){t&1&&u(0,"span",35)}var D=(()=>{class t{formBuilder;route;router;requestService;accountService;employeeService;form;id;isAddMode;loading=!1;submitted=!1;requestTypes=["equipment","leave","resource","other"];employees=[];constructor(e,o,r,p,pe,ue){this.formBuilder=e,this.route=o,this.router=r,this.requestService=p,this.accountService=pe,this.employeeService=ue}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({type:["",b.required],description:["",b.required],employeeId:["",b.required],items:this.formBuilder.array([])}),this.employeeService.getAll().subscribe(e=>{this.employees=e}),this.isAddMode||(this.loading=!0,this.requestService.getById(this.id).pipe(f()).subscribe(e=>{this.form.patchValue(e),e.items&&e.items.forEach(o=>{this.addItem(o)}),this.loading=!1}))}get f(){return this.form.controls}get items(){return this.form.get("items")}addItem(e){let o=this.formBuilder.group({description:[e?.description||"",b.required],quantity:[e?.quantity||1,[b.required,b.min(1)]]});this.items.push(o)}removeItem(e){this.items.removeAt(e)}onSubmit(){this.submitted=!0,!this.form.invalid&&(this.loading=!0,this.isAddMode?this.createRequest():this.updateRequest())}createRequest(){let e=B({},this.form.value);this.requestService.create(e).pipe(f()).subscribe({next:()=>{this.router.navigate(["../"],{relativeTo:this.route})},error:o=>{console.error("Error creating request:",o),this.loading=!1}})}updateRequest(){this.requestService.update(this.id,this.form.value).pipe(f()).subscribe({next:()=>{this.router.navigate(["../"],{relativeTo:this.route})},error:e=>{console.error("Error updating request:",e),this.loading=!1}})}static \u0275fac=function(o){return new(o||t)(g(oe),g(se),g(de),g(N),g(F),g(me))};static \u0275cmp=I({type:t,selectors:[["ng-component"]],decls:39,vars:17,consts:[[1,"container","mt-4"],[1,"card","shadow-sm"],[1,"card-header","bg-white","border-bottom-0","pb-0"],[1,"mb-0"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["formControlName","type",1,"form-select",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formControlName","employeeId",1,"form-select",3,"ngClass"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"form-label","mb-0"],["type","button",1,"btn","btn-sm","btn-primary","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-plus"],["formArrayName","items",1,"items-container"],["class","item-row mb-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","mt-4"],["routerLink","../",1,"btn","btn-secondary","px-4",3,"disabled"],[1,"btn","btn-primary","px-4","d-flex","align-items-center","gap-2",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],[1,"fas","fa-save"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],[1,"item-row","mb-2",3,"formGroupName"],[1,"row","g-2","align-items-center"],[1,"col"],["formControlName","description","placeholder","Item Description",1,"form-control",3,"ngClass"],[1,"col-auto"],["type","number","formControlName","quantity",1,"form-control",2,"width","100px",3,"ngClass"],["type","button","title","Remove Item",1,"btn","btn-sm","btn-outline-danger","d-flex","align-items-center","gap-1",3,"click"],[1,"fas","fa-trash"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),s(4),n()(),i(5,"div",4)(6,"form",5),_("ngSubmit",function(){return r.onSubmit()}),i(7,"div",6)(8,"label",7),s(9,"Type"),n(),i(10,"select",8)(11,"option",9),s(12,"Select Type"),n(),l(13,Me,3,4,"option",10),n(),l(14,Oe,2,1,"div",11),n(),i(15,"div",6)(16,"label",7),s(17,"Employee"),n(),i(18,"select",12)(19,"option",9),s(20,"Select Employee"),n(),l(21,we,2,4,"option",10),n(),l(22,Te,2,1,"div",11),n(),i(23,"div",6)(24,"div",13)(25,"label",14),s(26,"Items"),n(),i(27,"button",15),_("click",function(){return r.addItem()}),u(28,"i",16),s(29," Add Item "),n()(),i(30,"div",17),l(31,Le,11,9,"div",18),n()(),i(32,"div",19)(33,"button",20),s(34," Cancel "),n(),i(35,"button",21),l(36,Ve,1,0,"span",22),u(37,"i",23),s(38),n()()()()()()),o&2&&(a(4),C("",r.isAddMode?"Create":"Edit"," Request"),a(2),d("formGroup",r.form),a(4),d("ngClass",S(13,R,r.submitted&&r.f.type.errors)),a(3),d("ngForOf",r.requestTypes),a(),d("ngIf",r.submitted&&r.f.type.errors),a(4),d("ngClass",S(15,R,r.submitted&&r.f.employeeId.errors)),a(3),d("ngForOf",r.employees),a(),d("ngIf",r.submitted&&r.f.employeeId.errors),a(9),d("ngForOf",r.items.controls),a(2),d("disabled",r.loading),a(2),d("disabled",r.loading),a(),d("ngIf",r.loading),a(2),C(" ",r.isAddMode?"Create":"Update"," Request "))},dependencies:[O,w,P,W,ne,re,H,X,ie,J,K,Y,te,Z,ee,k,T],styles:[".items-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:1rem;border:1px solid #dee2e6;border-radius:.25rem;background-color:#f8f9fa}.item-row[_ngcontent-%COMP%]{background-color:#fff;padding:.5rem;border-radius:.25rem;border:1px solid #dee2e6;transition:box-shadow .2s,background .2s}.item-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;box-shadow:0 2px 8px #0000000f}.form-label[_ngcontent-%COMP%]{font-weight:500}.btn-danger[_ngcontent-%COMP%], .btn-outline-danger[_ngcontent-%COMP%]{padding:.25rem .5rem}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{min-width:100px;font-weight:500}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#86b7fe;box-shadow:0 0 0 .25rem #0d6efd26}.card[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #e3e6ea}.card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #e3e6ea;padding:1.25rem 2rem .5rem}.card-body[_ngcontent-%COMP%]{padding:2rem}.mt-4[_ngcontent-%COMP%]{margin-top:2rem!important}.gap-1[_ngcontent-%COMP%]{gap:.25rem}.gap-2[_ngcontent-%COMP%]{gap:.5rem}"]})}return t})();var De=[{path:"",component:le},{path:"add",component:D},{path:"edit/:id",component:D}],ce=(()=>{class t{static \u0275fac=function(o){return new(o||t)};static \u0275mod=M({type:t});static \u0275inj=q({imports:[L.forChild(De),L]})}return t})();var at=(()=>{class t{static \u0275fac=function(o){return new(o||t)};static \u0275mod=M({type:t});static \u0275inj=q({imports:[U,ae,ce]})}return t})();export{at as RequestsModule};
